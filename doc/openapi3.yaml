openapi: 3.0.4
info:
  title: Orticello API
  version: 1.0.0
  description: API for managing community gardens (orti urbani) in Trento
servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://orticelloapi.onrender.com
    description: Production server
tags:
  - name: Authentication
    description: User authentication endpoints
  - name: Orti
    description: Garden management endpoints
  - name: Lotti
    description: Plot management endpoints
  - name: Utenti
    description: User management endpoints
  - name: Associazioni
    description: Association management endpoints
  - name: Comune
    description: Municipality management endpoints
  - name: AffidaLotti
    description: Plot assignment endpoints
  - name: AffidaOrti
    description: Garden assignment endpoints
  - name: Avvisi
    description: Notice management endpoints
  - name: Bandi
    description: Competition announcement endpoints
  - name: Meteo
    description: Weather data endpoints
  - name: Sensor
    description: Sensor data endpoints
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Orto:
      type: object
      required:
        - nome
        - indirizzo
        - comune
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439011
        nome:
          type: string
          description: Name of the garden
          example: Orto San Bartolomeo
        indirizzo:
          type: string
          description: Address of the garden
          example: Via San Bartolomeo 15, Trento
        comune:
          type: string
          description: Reference to Comune ObjectId
          example: 507f1f77bcf86cd799439015
        createdAt:
          type: string
          format: date-time
          description: Timestamp of creation (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
    Lotto:
      type: object
      required:
        - dimensione
        - sensori
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439012
        dimensione:
          type: number
          description: Size of the plot in square meters
          example: 50
        sensori:
          type: boolean
          description: Whether the plot is equipped with sensors
          example: true
    Associazione:
      type: object
      required:
        - nome
        - indirizzo
        - telefono
        - email
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439014
        nome:
          type: string
          description: Name of the association
          example: Associazione Orti Urbani Trento
        indirizzo:
          type: string
          description: Address of the association
          example: Via delle Associazioni 45, Trento
        telefono:
          type: string
          description: Phone number (mobile format validated)
          example: "+393331234567"
        email:
          type: string
          format: email
          description: Email address (unique, validated)
          example: info@ortiurbanitrento.it
        createdAt:
          type: string
          format: date-time
          description: Timestamp of creation (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
    Comune:
      type: object
      required:
        - nome
        - indirizzo
        - telefono
        - email
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439015
        nome:
          type: string
          description: Name of the municipality
          example: Comune di Trento
        indirizzo:
          type: string
          description: Address of the municipality
          example: Piazza Duomo 1, Trento
        telefono:
          type: string
          description: Phone number of the municipality
          example: "+390461884111"
        email:
          type: string
          format: email
          description: Email address (unique, validated)
          example: info@comune.trento.it
        createdAt:
          type: string
          format: date-time
          description: Timestamp of creation (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
    Utente:
      type: object
      required:
        - nome
        - cognome
        - codicefiscale
        - email
        - indirizzo
        - telefono
        - tipo
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439016
        nome:
          type: string
          description: First name of the user
          example: Mario
        cognome:
          type: string
          description: Last name of the user
          example: Rossi
        codicefiscale:
          type: string
          description: Italian tax ID (validated)
          example: RSSMRA80A01H501U
        email:
          type: string
          format: email
          description: Email address (unique, validated)
          example: mario.rossi@example.com
        password:
          type: string
          description: Password (hashed in future implementation)
          writeOnly: true
          example: securePassword123
        indirizzo:
          type: string
          description: User address
          example: Via Roma 10, Trento
        telefono:
          type: string
          description: Mobile phone number (validated)
          example: "+393331234567"
        tipo:
          type: string
          enum:
            - citt
            - asso
            - comu
          description: User type (citt=citizen, asso=association, comu=municipality)
          default: citt
          example: citt
        associazione:
          type: string
          description: Reference to Associazione (required if tipo=asso)
          example: 507f1f77bcf86cd799439014
        comune:
          type: string
          description: Reference to Comune (required if tipo=comu)
          example: 507f1f77bcf86cd799439015
        admin:
          type: boolean
          description: Admin flag (required if tipo != citt)
          default: false
          example: false
    AffidaLotto:
      type: object
      required:
        - lotto
        - utente
        - data_inizio
        - data_fine
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439017
        lotto:
          type: string
          description: Reference to Lotto ObjectId
          example: 507f1f77bcf86cd799439012
        utente:
          type: string
          description: Reference to Utente ObjectId
          example: 507f1f77bcf86cd799439016
        data_inizio:
          type: string
          format: date
          description: Assignment start date
          example: 2025-01-01
        data_fine:
          type: string
          format: date
          description: Assignment end date
          example: 2025-12-31
        colture:
          type: array
          items:
            type: string
          description: List of crops planted by the user
          example:
            - Pomodori
            - Zucchine
            - Insalata
        createdAt:
          type: string
          format: date-time
          description: Timestamp of creation (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
    AffidaOrto:
      type: object
      required:
        - orto
        - associazione
        - data_inizio
        - data_fine
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439018
        orto:
          type: string
          description: Reference to Orto ObjectId
          example: 507f1f77bcf86cd799439011
        associazione:
          type: string
          description: Reference to Associazione ObjectId
          example: 507f1f77bcf86cd799439014
        data_inizio:
          type: string
          format: date
          description: Assignment start date
          example: 2025-01-01
        data_fine:
          type: string
          format: date
          description: Assignment end date
          example: 2025-12-31
        createdAt:
          type: string
          format: date-time
          description: Timestamp of creation (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update (generated automatically)
          readOnly: true
          example: 2025-12-11T10:30:00.000Z
    Avviso:
      type: object
      required:
        - titolo
        - tipo
        - data
        - messaggio
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439019
        titolo:
          type: string
          description: Notice title
          example: Chiusura per manutenzione
        tipo:
          type: string
          enum:
            - asso
            - comu
          description: Notice type (asso=association, comu=municipality)
          default: asso
          example: comu
        comune:
          type: string
          description: Reference to Comune (required if tipo=comu)
          example: 507f1f77bcf86cd799439015
        associazione:
          type: string
          description: Reference to Associazione (required if tipo=asso)
          example: 507f1f77bcf86cd799439014
        data:
          type: string
          format: date
          description: Notice date
          example: 2025-12-15
        target:
          type: string
          enum:
            - asso
            - all
          description: Target audience (required if tipo=comu)
          default: all
          example: all
        messaggio:
          type: string
          description: Notice message content
          example: Gli orti rimarranno chiusi per manutenzione dal 20 al 25 dicembre
        categoria:
          type: string
          description: Optional category
          example: manutenzione
    Bando:
      type: object
      required:
        - titolo
        - data_inizio
        - data_fine
        - messaggio
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439020
        titolo:
          type: string
          description: Competition announcement title
          example: Bando per assegnazione lotti 2026
        data_inizio:
          type: string
          format: date
          description: Application period start date
          example: 2026-01-01
        data_fine:
          type: string
          format: date
          description: Application period end date
          example: 2026-01-31
        messaggio:
          type: string
          description: Competition announcement message
          example: Sono aperti i bandi per l'assegnazione dei lotti per l'anno 2026
        link:
          type: string
          description: Optional link to full announcement
          example: https://www.comune.trento.it/bandi/orti-2026
    Meteo:
      type: object
      required:
        - coordinate
        - timestamp
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439021
        coordinate:
          type: object
          required:
            - lat
            - lng
          properties:
            lat:
              type: number
              description: Latitude in decimal degrees (WGS84)
              example: 46.0664
            lng:
              type: number
              description: Longitude in decimal degrees (WGS84)
              example: 11.1257
        timestamp:
          type: string
          format: date-time
          description: Observation timestamp
          example: 2025-12-11T14:30:00.000Z
        rilev:
          type: string
          description: Meteorological reading or notes (TODO - structure to be defined)
          example: "Temperature: 15°C, Humidity: 65%"
    Sensor:
      type: object
      required:
        - lotto
        - timestamp
      properties:
        _id:
          type: string
          description: MongoDB ObjectId (generated automatically)
          readOnly: true
          example: 507f1f77bcf86cd799439022
        lotto:
          type: string
          description: Reference to Lotto ObjectId
          example: 507f1f77bcf86cd799439012
        timestamp:
          type: string
          format: date-time
          description: Reading timestamp
          example: 2025-12-11T14:30:00.000Z
        rilev:
          type: string
          description: Sensor payload (TODO - structure to be defined)
          example: "Soil moisture: 45%, Temperature: 18°C"
paths:
  /api/v1/affidaLotti:
    get:
      summary: Get list of lotto assignments
      description: >
        Retrieve a list of all lotto assignments (affidaLotti). Returns an array
        showing which 

        users have been assigned to which lotti, including assignment dates and
        optional colture 

        information.


        **Access Control:**

        - **Comune**: Can view all lotto assignments

        - **Associazioni**: Can view assignments within their managed orti

        - **Cittadini**: Can view assignments (for map visualization)
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved list of affida lotti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AffidaLotto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - User does not have the required role
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "500":
          description: Internal server error while retrieving affida lotti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving affida lotti
                  error:
                    type: object
    post:
      summary: Create a new lotto assignment request
      description: >
        Create a new lotto assignment or assignment request. The behavior varies
        based on user role:

        - **Cittadini**: Create a request for a lotto (RF6.3) - dates are
        optional/pending approval

        - **Comune/Associazioni**: Directly assign a lotto with confirmed dates
        (RF18)


        Optionally includes a list of crops (colture) the user plans to
        cultivate.


        **Business Rules:**

        - RF6.3: Richiesta Cittadino

        - RF18: Assegnazione diretta Comune/Associazione
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AffidaLotto"
            example:
              lotto: 507f1f77bcf86cd799439011
              utente: 507f191e810c19729de860ea
              data_inizio: 2024-03-01
              data_fine: 2024-12-31
              colture:
                - Pomodori
                - Zucchine
                - Basilico
      responses:
        "201":
          description: AffidaLotto created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaLotto"
        "400":
          description: Invalid input data - Missing required fields or invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - User does not have the required role
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "500":
          description: Internal server error while creating affida lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error creating affida lotto
                  error:
                    type: object
  /api/v1/affidaLotti/attivi:
    get:
      summary: Get active lotto assignments
      description: >
        Retrieve only lotto assignments that have already started and not yet
        ended 

        (data_inizio <= now <= data_fine). Results include populated lotto and
        utente data 

        and are sorted by end date. Used to filter occupied lots on the map.


        **Access Control:**

        - **Comune**: Can view all active assignments

        - **Associazioni**: Can view active assignments within their managed
        orti

        - **Cittadini**: Can view active assignments (for map visualization)
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved list of active affida lotti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AffidaLotto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - User does not have the required role
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "500":
          description: Internal server error while retrieving active affida lotti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving active affida lotti
                  error:
                    type: object
  /api/v1/affidaLotti/{id}:
    get:
      summary: Get lotto assignment by ID
      description: >
        Retrieve a single lotto assignment by its unique MongoDB ObjectId.
        Returns detailed 

        information including the assigned lotto, user, dates, and crops.


        **Access Control:**

        - Accessible to all authenticated users
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida lotto
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: Successfully retrieved affida lotto
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaLotto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "404":
          description: AffidaLotto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaLotto not found
        "500":
          description: Internal server error while retrieving affida lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving affida lotto
                  error:
                    type: object
    put:
      summary: Update lotto assignment by ID
      description: >
        Update an existing lotto assignment with new information such as dates,
        notes, or 

        other attributes. Generic update endpoint for assignment modifications.


        **Access Control:**

        - **Strictly reserved for Associazioni and Comune users**


        **Business Rule:** RF25 - Modifica/approvazione affido
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida lotto to update
          example: 507f1f77bcf86cd799439011
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AffidaLotto"
            example:
              data_inizio: 2024-03-15
              data_fine: 2025-03-14
              note: Estensione periodo di assegnazione
      responses:
        "200":
          description: AffidaLotto updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaLotto"
        "400":
          description: Invalid input data - Missing required fields or invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Associazioni and Comune can update assignments
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaLotto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaLotto not found
        "500":
          description: Internal server error while updating affida lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error updating affida lotto
                  error:
                    type: object
    delete:
      summary: Delete lotto assignment by ID
      description: >
        Remove an existing lotto assignment from the system. This permanently
        deletes the 

        assignment record.


        **Access Control:**

        - **Strictly reserved for Associazioni and Comune users**


        **Warning:** This operation cannot be undone. Consider the impact on
        historical 

        records and user assignments.
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida lotto to delete
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: AffidaLotto deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaLotto deleted successfully
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Associazioni and Comune can delete assignments
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaLotto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaLotto not found
        "500":
          description: Internal server error while deleting affida lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error deleting affida lotto
                  error:
                    type: object
  /api/v1/affidaLotti/{id}/gestisci:
    put:
      summary: Approve or reject a lotto assignment request
      description: >
        Allows **Associazione** or **Comune** to approve or reject a citizen's
        lotto assignment 

        request.


        **Actions:**

        - **accetta**: Approves the request and sets start/end dates, making the
        assignment active

        - **rifiuta**: Rejects and deletes the request


        **Access Control:**

        - **Strictly reserved for Associazioni and Comune users**


        This is a fundamental route for the request approval workflow.
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida lotto request
          example: 507f1f77bcf86cd799439011
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - azione
              properties:
                azione:
                  type: string
                  enum:
                    - accetta
                    - rifiuta
                  description: Action to perform on the request
                data_inizio:
                  type: string
                  format: date
                  description: Start date (required if azione is 'accetta')
                data_fine:
                  type: string
                  format: date
                  description: End date (required if azione is 'accetta')
            example:
              azione: accetta
              data_inizio: 2024-03-01
              data_fine: 2024-12-31
      responses:
        "200":
          description: Request processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Richiesta accettata con successo
                  affidaLotto:
                    $ref: "#/components/schemas/AffidaLotto"
        "400":
          description: Invalid action or missing required fields
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Azione non valida o dati mancanti
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Associazioni and Comune can manage requests
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaLotto request not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Richiesta non trovata
        "500":
          description: Internal server error while processing request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nella gestione della richiesta
                  error:
                    type: object
  /api/v1/affidaLotti/{id}/colture:
    post:
      summary: Add a crop to lotto assignment
      description: >
        Add a new crop (coltura) to the list of crops for a specific lotto
        assignment. 

        This allows citizens to track what they're growing on their assigned
        plot.


        **Access Control:**

        - **Strictly reserved for Cittadini** - Only the owner of the assignment
        can add crops
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida lotto
          example: 507f1f77bcf86cd799439011
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - coltura
              properties:
                coltura:
                  type: string
                  description: Name of the crop to add
                  example: Pomodori
      responses:
        "200":
          description: Coltura added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaLotto"
        "400":
          description: Invalid input data - Coltura name is required
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Coltura name is required
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only the assignment owner can add crops
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaLotto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaLotto not found
        "500":
          description: Internal server error while adding coltura
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error adding coltura
                  error:
                    type: object
  /api/v1/affidaLotti/{id}/colture/{coltura}:
    delete:
      summary: Remove a crop from lotto assignment
      description: >
        Remove a specific crop (coltura) from the list of crops for a lotto
        assignment. 

        Useful when a citizen changes what they're growing or harvests a crop.


        **Access Control:**

        - **Strictly reserved for Cittadini** - Only the owner of the assignment
        can remove crops
      tags:
        - AffidaLotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida lotto
          example: 507f1f77bcf86cd799439011
        - in: path
          name: coltura
          required: true
          schema:
            type: string
          description: Name of the crop to remove
          example: Pomodori
      responses:
        "200":
          description: Coltura removed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaLotto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only the assignment owner can remove crops
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaLotto not found or coltura not found in the assignment
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaLotto not found or coltura not found
        "500":
          description: Internal server error while removing coltura
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error removing coltura
                  error:
                    type: object
  /api/v1/affidaOrti:
    get:
      summary: Get list of orto assignments
      description: >
        Retrieve a list of all orto assignments (affidaOrti). Returns an array
        showing which associazioni 

        have been assigned to which orti, including assignment start and end
        dates.


        **Access Control:**

        - **Comune**: Can view all orto assignments

        - **Associazioni**: Can view only their own assignments
      tags:
        - AffidaOrti
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved list of affida orti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AffidaOrto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - User does not have the required role
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "500":
          description: Internal server error while retrieving affida orti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving affida orti
                  error:
                    type: object
    post:
      summary: Create a new orto assignment
      description: >
        Create a new assignment of an orto to an associazione with start and end
        dates.


        **Access Control:**

        - **Strictly reserved for Comune users only (RF18)**


        **Business Rule (RF18):** Il Comune assegna gli orti alle associazioni
      tags:
        - AffidaOrti
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AffidaOrto"
            example:
              orto: 507f1f77bcf86cd799439011
              associazione: 507f191e810c19729de860ea
              dataInizio: 2024-01-01
              dataFine: 2025-12-31
      responses:
        "201":
          description: AffidaOrto created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaOrto"
        "400":
          description: Invalid input data - Missing required fields or invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune users can create orto assignments
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden - Only Comune can create assignments
        "500":
          description: Internal server error while creating affida orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error creating affida orto
                  error:
                    type: object
  /api/v1/affidaOrti/active:
    get:
      summary: Get list of active orto assignments
      description: >
        Retrieve a list of orto assignments that are currently active (where
        today's date falls within 

        the assignment date range). Returns an array showing which associazioni
        are currently assigned 

        to which orti.


        **Access Control:**

        - **Comune**: Can view all active assignments

        - **Associazioni**: Can view only their own active assignments
      tags:
        - AffidaOrti
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved list of active affida orti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AffidaOrto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - User does not have the required role
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "500":
          description: Internal server error while retrieving active affida orti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving active affida orti
                  error:
                    type: object
  /api/v1/affidaOrti/{id}:
    get:
      summary: Get orto assignment by ID
      description: >
        Retrieve a single orto assignment by its unique MongoDB ObjectId.
        Returns detailed information 

        about the assignment including the associated orto and associazione.


        **Access Control:**

        - **Comune**: Can view any assignment

        - **Associazioni**: Can view only their own assignments
      tags:
        - AffidaOrti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida orto
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: Successfully retrieved affida orto
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaOrto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - User does not have the required role
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaOrto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaOrto not found
        "500":
          description: Internal server error while retrieving affida orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving affida orto
                  error:
                    type: object
    put:
      summary: Update orto assignment by ID
      description: >
        Update an existing orto assignment with new information (dates, orto,
        associazione).


        **Access Control:**

        - **Strictly reserved for Comune users only**


        Solo il Comune gestisce i contratti macro di assegnazione degli orti.
      tags:
        - AffidaOrti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida orto to update
          example: 507f1f77bcf86cd799439011
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AffidaOrto"
            example:
              orto: 507f1f77bcf86cd799439011
              associazione: 507f191e810c19729de860ea
              dataInizio: 2024-01-01
              dataFine: 2026-12-31
      responses:
        "200":
          description: AffidaOrto updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AffidaOrto"
        "400":
          description: Invalid input data - Missing required fields or invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune users can update orto assignments
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaOrto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaOrto not found
        "500":
          description: Internal server error while updating affida orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error updating affida orto
                  error:
                    type: object
    delete:
      summary: Delete orto assignment by ID
      description: >
        Remove an existing orto assignment from the system (Revoke management).


        **Access Control:**

        - **Strictly reserved for Comune users only**


        Solo il Comune può revocare la gestione degli orti assegnati alle
        associazioni.
      tags:
        - AffidaOrti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the affida orto to delete
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: AffidaOrto deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaOrto deleted successfully
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune users can delete orto assignments
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: AffidaOrto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AffidaOrto not found
        "500":
          description: Internal server error while deleting affida orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error deleting affida orto
                  error:
                    type: object
  /api/v1/associazioni:
    get:
      summary: Get list of associazioni
      description: Retrieve a list of all associazioni (associations). Returns an
        array of associazione objects with their details.
      tags:
        - Associazioni
      responses:
        "200":
          description: Successfully retrieved list of associazioni
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Associazione"
        "500":
          description: Error retrieving associazioni
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nel recupero delle associazioni
                  error:
                    type: string
    post:
      summary: Create a new associazione
      description: Create a new association with the provided information. Only
        accessible by municipality users.
      security:
        - bearerAuth: []
      tags:
        - Associazioni
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Associazione"
      responses:
        "201":
          description: Associazione created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Associazione"
        "400":
          description: Invalid data or duplicate entry
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Dati non validi o duplicati
                  error:
                    type: string
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only municipality users can create associations
        "500":
          description: Error creating associazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nella creazione dell'associazione
                  error:
                    type: string
  /api/v1/associazioni/{id}:
    get:
      summary: Get associazione by ID
      description: Retrieve a single association by its unique identifier
      tags:
        - Associazioni
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the associazione
      responses:
        "200":
          description: Successfully retrieved associazione
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Associazione"
        "404":
          description: Associazione not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Associazione non trovata
        "500":
          description: Error retrieving associazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nel recupero dell'associazione
                  error:
                    type: string
    put:
      summary: Update associazione by ID
      description: Update an existing association with new information. Accessible by
        association admins and municipality users.
      security:
        - bearerAuth: []
      tags:
        - Associazioni
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the associazione
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Associazione"
      responses:
        "200":
          description: Associazione updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Associazione"
        "400":
          description: Invalid update data
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Dati aggiornati non validi
                  error:
                    type: string
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only association admins or municipality users can update
        "404":
          description: Associazione not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Associazione non trovata
        "500":
          description: Error updating associazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nell'aggiornamento dell'associazione
                  error:
                    type: string
    delete:
      summary: Delete associazione by ID
      description: Delete an association by its unique identifier. Only accessible by
        municipality users.
      security:
        - bearerAuth: []
      tags:
        - Associazioni
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the associazione
      responses:
        "200":
          description: Associazione deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Associazione eliminata con successo
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only municipality users can delete associations
        "404":
          description: Associazione not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Associazione non trovata
        "500":
          description: Error deleting associazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore durante l'eliminazione
                  error:
                    type: string
  /api/v1/associazioni/{id}/membri:
    get:
      summary: Get all members of an associazione
      description: Retrieve a list of all users (utenti) who are members of a specific
        association. Accessible by association and municipality users.
      security:
        - bearerAuth: []
      tags:
        - Associazioni
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the associazione
      responses:
        "200":
          description: Successfully retrieved members list
          content:
            application/json:
              schema:
                type: object
                properties:
                  associazione:
                    type: object
                    properties:
                      id:
                        type: string
                      nome:
                        type: string
                  count:
                    type: integer
                    description: Number of members
                  membri:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                        nome:
                          type: string
                        cognome:
                          type: string
                        email:
                          type: string
                        telefono:
                          type: string
                        admin:
                          type: boolean
                        createdAt:
                          type: string
                          format: date-time
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only association and municipality users can view members
        "404":
          description: Associazione not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Associazione non trovata
        "500":
          description: Error retrieving members
    post:
      summary: Add a member to an associazione
      description: Add an existing user as a member of the association. The user's
        type will be changed to 'asso' and linked to this association. Only
        accessible by association admins (RF22).
      security:
        - bearerAuth: []
      tags:
        - Associazioni
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the associazione
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - utenteId
              properties:
                utenteId:
                  type: string
                  description: MongoDB ObjectId of the user to add as member
                  example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: Member added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Membro aggiunto con successo
                  data:
                    type: object
                    properties:
                      utente:
                        type: object
                        properties:
                          id:
                            type: string
                          nome:
                            type: string
                          cognome:
                            type: string
                          email:
                            type: string
                          tipo:
                            type: string
                            example: asso
                      associazione:
                        type: object
                        properties:
                          id:
                            type: string
                          nome:
                            type: string
        "400":
          description: Bad request - User already member or validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Membro già presente nell'associazione
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only association admins can add members
        "404":
          description: Associazione or Utente not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "500":
          description: Error adding member
  /api/v1/associazioni/{id}/membri/{utenteId}:
    delete:
      summary: Remove a member from an associazione
      description: Remove a user from the association. The user's type will be changed
        back to 'citt' (citizen) and the association link will be removed. Only
        accessible by association admins (RF22).
      security:
        - bearerAuth: []
      tags:
        - Associazioni
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the associazione
        - in: path
          name: utenteId
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the user to remove
      responses:
        "200":
          description: Member removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Membro rimosso con successo
                  data:
                    type: object
                    properties:
                      utente:
                        type: object
                        properties:
                          id:
                            type: string
                          nome:
                            type: string
                          cognome:
                            type: string
                          email:
                            type: string
                          tipo:
                            type: string
                            example: citt
        "400":
          description: User is not a member of this association
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Membro non trovato in questa associazione
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only association admins can remove members
        "404":
          description: Associazione or Utente not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "500":
          description: Error removing member
  /api/v1/authentication:
    post:
      summary: Authenticate user and generate JWT token
      description: Authenticate a user with email and password or Google token.
        Returns a JWT token valid for 24 hours.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address (required if not using googleToken)
                  example: paolo.rossi@rossi.it
                password:
                  type: string
                  description: User's password (required if not using googleToken)
                  example: 12345678
                googleToken:
                  type: string
                  description: Google authentication token (alternative to email/password)
            examples:
              emailPassword:
                summary: Login with email and password
                value:
                  email: paolo.rossi@rossi.it
                  password: 12345678
              googleAuth:
                summary: Login with Google token
                value:
                  googleToken: eyJhbGciOiJSUzI1NiIsImtpZCI6...
      responses:
        "200":
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Token generated
                  token:
                    type: string
                    description: JWT token (expires in 24 hours)
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  email:
                    type: string
                    example: paolo.rossi@rossi.it
                  id:
                    type: string
                    description: User's MongoDB ObjectId
                    example: 693bfed09c0ff8cb58ab35fe
                  self:
                    type: string
                    description: Link to user resource
                    example: /api/v1/utenti/693bfed09c0ff8cb58ab35fe
        "401":
          description: Authentication failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                userNotFound:
                  value:
                    message: Authentication failed. User not found.
                wrongPassword:
                  value:
                    message: Authentication failed. Wrong password.
  /api/v1/avvisi:
    get:
      summary: Get list of notices
      description: Retrieve a list of all notices (avvisi). Returns an array of avviso
        objects with details including titolo, tipo (asso/comu), data,
        messaggio, and references to comune or associazione.
      tags:
        - Avvisi
      responses:
        "200":
          description: Successfully retrieved list of avvisi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Avviso"
        "500":
          description: Error retrieving avvisi
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving avvisi
                  error:
                    type: object
    post:
      summary: Create a new notice
      description: Create a new avviso with the provided information. The notice can
        be created by an associazione or comune, with different required fields
        based on the tipo.
      tags:
        - Avvisi
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Avviso"
      responses:
        "201":
          description: Avviso created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Avviso"
        "400":
          description: Invalid input data
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
        "500":
          description: Error creating avviso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error creating avviso
                  error:
                    type: object
  /api/v1/avvisi/filtered:
    get:
      summary: Get filtered notices with pagination
      description: Retrieve notices filtered by multiple criteria including entity
        type, date range, category, and read status. Supports pagination.
      tags:
        - Avvisi
      parameters:
        - in: query
          name: tipo
          schema:
            type: string
            enum:
              - asso
              - comu
          description: Filter by entity type (association or municipality)
        - in: query
          name: entityId
          schema:
            type: string
          description: Filter by specific entity ID (comune or associazione)
        - in: query
          name: categoria
          schema:
            type: string
          description: Filter by category
        - in: query
          name: dataInizio
          schema:
            type: string
            format: date-time
          description: Filter notices from this date onwards (ISO format)
        - in: query
          name: dataFine
          schema:
            type: string
            format: date-time
          description: Filter notices up to this date (ISO format)
        - in: query
          name: target
          schema:
            type: string
            enum:
              - asso
              - all
          description: Filter by target audience (for municipality notices)
        - in: query
          name: letto
          schema:
            type: boolean
          description: Filter by read status (requires authentication)
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
          description: Number of items per page
      responses:
        "200":
          description: Successfully retrieved filtered avvisi
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Avviso"
                  pagination:
                    type: object
                    properties:
                      currentPage:
                        type: integer
                      totalPages:
                        type: integer
                      totalItems:
                        type: integer
                      itemsPerPage:
                        type: integer
        "500":
          description: Error retrieving filtered avvisi
  /api/v1/avvisi/{id}:
    get:
      summary: Get notice by ID
      description: Retrieve a single avviso by its unique identifier
      tags:
        - Avvisi
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the avviso
      responses:
        "200":
          description: Successfully retrieved avviso
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Avviso"
        "404":
          description: Avviso not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Avviso not found
        "500":
          description: Error retrieving avviso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving avviso
                  error:
                    type: object
    put:
      summary: Update notice by ID
      description: Update an existing avviso with new information
      tags:
        - Avvisi
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the avviso
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Avviso"
      responses:
        "200":
          description: Avviso updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Avviso"
        "400":
          description: Invalid input data
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
        "404":
          description: Avviso not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Avviso not found
        "500":
          description: Error updating avviso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error updating avviso
                  error:
                    type: object
    delete:
      summary: Delete notice by ID
      description: Remove an existing avviso from the system
      tags:
        - Avvisi
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the avviso
      responses:
        "200":
          description: Avviso deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Avviso deleted successfully
        "404":
          description: Avviso not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Avviso not found
        "500":
          description: Error deleting avviso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error deleting avviso
                  error:
                    type: object
  /api/v1/avvisi/{id}/read:
    put:
      summary: Mark notice as read
      description: Mark an avviso as read by the authenticated user. Creates or
        updates read status.
      tags:
        - Avvisi
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the avviso
      responses:
        "200":
          description: Notice marked as read successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Notice marked as read
                  data:
                    type: object
                    properties:
                      avvisoId:
                        type: string
                      dataLettura:
                        type: string
                        format: date-time
        "401":
          description: Authentication required
        "404":
          description: Avviso not found
        "500":
          description: Error marking avviso as read
  /api/v1/avvisi/read-status:
    post:
      summary: Get read status for multiple notices
      description: Get read status for multiple avvisi for the authenticated user
      tags:
        - Avvisi
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                avvisiIds:
                  type: array
                  items:
                    type: string
                  description: Array of avviso IDs to check
      responses:
        "200":
          description: Read status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        letto:
                          type: boolean
                        dataLettura:
                          type: string
                          format: date-time
                          nullable: true
        "400":
          description: Invalid input
        "401":
          description: Authentication required
        "500":
          description: Error retrieving read status
  /api/v1/bandi:
    get:
      summary: Get list of announcements
      description: Retrieve a list of all announcements. Use query param 'active=true'
        to filter only current ones.
      security:
        - bearerAuth: []
      tags:
        - Bandi
      parameters:
        - in: query
          name: active
          schema:
            type: boolean
          description: Se impostato a true, restituisce solo i bandi non scaduti (ordinati
            per scadenza).
      responses:
        "200":
          description: Successfully retrieved list of bandi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Bando"
        "500":
          description: Error retrieving bandi
    post:
      summary: Create a new announcement
      description: Create a new bando. Only accessible by Comune.
      security:
        - bearerAuth: []
      tags:
        - Bandi
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Bando"
      responses:
        "201":
          description: Bando created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Bando"
        "400":
          description: Invalid input data
        "500":
          description: Error creating bando
  /api/v1/bandi/attivi:
    get:
      summary: Get active announcements
      description: Retrieve only bandi that have already started and not yet ended
        (data_inizio <= now <= data_fine). Results are sorted by end date.
      security:
        - bearerAuth: []
      tags:
        - Bandi
      responses:
        "200":
          description: Successfully retrieved list of active bandi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Bando"
        "500":
          description: Error retrieving active bandi
  /api/v1/bandi/{id}:
    get:
      summary: Get announcement by ID
      description: Retrieve a single bando by ID.
      security:
        - bearerAuth: []
      tags:
        - Bandi
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successfully retrieved bando
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Bando"
        "404":
          description: Bando not found
        "500":
          description: Error retrieving bando
    put:
      summary: Update announcement by ID
      description: Update an existing bando. Only accessible by Comune.
      security:
        - bearerAuth: []
      tags:
        - Bandi
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Bando"
      responses:
        "200":
          description: Bando updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Bando"
        "404":
          description: Bando not found
        "500":
          description: Error updating bando
    delete:
      summary: Delete announcement by ID
      description: Remove an existing bando. Only accessible by Comune.
      security:
        - bearerAuth: []
      tags:
        - Bandi
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Bando deleted successfully
        "404":
          description: Bando not found
        "500":
          description: Error deleting bando
  /api/v1/comune:
    get:
      summary: Get list of comuni
      description: >
        Retrieve a list of all comuni (municipalities). Returns an array of
        comune objects 

        with their complete details including name, address, contact
        information, and other 

        administrative data.


        **Access Control:**

        - Accessible to all authenticated users
      tags:
        - Comune
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved list of comuni
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Comune"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "500":
          description: Internal server error while retrieving comuni
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nel recupero dei comuni
                  error:
                    type: object
    post:
      summary: Create a new comune
      description: >
        Create a new municipality entity with the provided information including
        administrative 

        details, contact information, and geographic data.


        **Access Control:**

        - **Strictly reserved for Comune Admin users only**


        Solo un Admin del Comune (o un SuperAdmin se esistesse) può creare
        l'entità Comune.
      tags:
        - Comune
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Comune"
            example:
              nome: Bolzano
              indirizzo: Piazza Municipio, 5
              cap: "39100"
              provincia: BZ
              telefono: +39 0471 997111
              email: info@comune.bolzano.it
              pec: comune.bolzano@legalmail.it
      responses:
        "201":
          description: Comune created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Comune"
        "400":
          description: Invalid data or duplicate entry - Required fields missing or
            invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Dati non validi o duplicati
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune Admin users can create municipalities
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden - Insufficient privileges
        "500":
          description: Internal server error while creating comune
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nella creazione del comune
                  error:
                    type: object
  /api/v1/comune/{id}:
    get:
      summary: Get comune by ID
      description: >
        Retrieve a single municipality by its unique MongoDB ObjectId. Returns
        complete 

        details about the specific comune.


        **Access Control:**

        - Accessible to all authenticated users
      tags:
        - Comune
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the comune
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: Successfully retrieved comune
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Comune"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "404":
          description: Comune not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Comune non trovato
        "500":
          description: Internal server error while retrieving comune
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nel recupero del comune
                  error:
                    type: object
    put:
      summary: Update comune by ID
      description: >
        Update an existing municipality with new information. Allows
        modification of administrative 

        details, contact information, and other comune attributes.


        **Access Control:**

        - **Strictly reserved for Comune Admin users only**


        Solo l'Admin del Comune può modificare i dati dell'ente.
      tags:
        - Comune
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the comune to update
          example: 507f1f77bcf86cd799439011
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Comune"
            example:
              nome: Bolzano
              indirizzo: Piazza Municipio, 5
              cap: "39100"
              provincia: BZ
              telefono: +39 0471 997111
              email: info@comune.bolzano.it
              pec: comune.bolzano@legalmail.it
      responses:
        "200":
          description: Comune updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Comune"
        "400":
          description: Invalid update data - Missing required fields or invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Dati aggiornati non validi
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune Admin users can update municipalities
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden - Insufficient privileges
        "404":
          description: Comune not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Comune non trovato
        "500":
          description: Internal server error while updating comune
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nell'aggiornamento del comune
                  error:
                    type: object
    delete:
      summary: Delete comune by ID
      description: >
        Delete a municipality by its unique identifier. This operation
        permanently removes 

        the comune from the system.


        **Access Control:**

        - **Strictly reserved for Comune Admin users only**


        **Warning:** This operation may have cascading effects on related
        entities (orti, 

        affidamenti, etc.). Use with caution.
      tags:
        - Comune
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the comune to delete
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: Comune deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Comune eliminato con successo
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune Admin users can delete municipalities
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden - Insufficient privileges
        "404":
          description: Comune not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Comune non trovato
        "500":
          description: Internal server error while deleting comune
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore durante l'eliminazione
                  error:
                    type: object
  /api/v1/lotti:
    get:
      summary: Get list of lotti
      description: >
        Retrieve a list of all lotti (plots). Returns an array of lotto objects
        with their 

        complete details including dimensions, status, sensor information, and
        associated orto.


        **Access Control:**

        - Accessible to **all authenticated users** (Cittadini, Associazioni,
        Comune)


        **Business Rules:** RF6, RF24, RF17 - Tutti devono poter vedere i lotti
      tags:
        - Lotti
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved list of lotti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Lotto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "500":
          description: Internal server error while retrieving lotti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving lotti
                  error:
                    type: object
    post:
      summary: Create a new lotto
      description: >
        Create a new plot configuration with detailed specifications including
        dimensions, 

        location coordinates, sensor assignments, and associated orto.


        **Access Control:**

        - **Strictly reserved for Comune users only**


        **Business Rules:** RF16/RF17 - Solo il Comune definisce la struttura
        degli orti e 

        aggiunge lotti
      tags:
        - Lotti
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Lotto"
            example:
              numero: A1
              superficie: 50
              orto: 507f1f77bcf86cd799439011
              coordinate:
                lat: 46.4983
                lng: 11.3548
              sensori:
                - tipo: umidita
                  id: SENS001
                - tipo: temperatura
                  id: SENS002
              stato: disponibile
      responses:
        "201":
          description: Lotto created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Lotto"
        "400":
          description: Invalid input data - Missing required fields or invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune users can create lotti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden - Only Comune can create lotti
        "500":
          description: Internal server error while creating lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error creating lotto
                  error:
                    type: object
  /api/v1/lotti/{id}:
    get:
      summary: Get lotto by ID
      description: >
        Retrieve a single plot by its unique MongoDB ObjectId. Returns detailed
        information 

        about the specific lotto including its dimensions, location, status,
        sensors, and 

        associated orto.


        **Access Control:**

        - Accessible to all authenticated users
      tags:
        - Lotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the lotto
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: Successfully retrieved lotto
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Lotto"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "404":
          description: Lotto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Lotto not found
        "500":
          description: Internal server error while retrieving lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving lotto
                  error:
                    type: object
    put:
      summary: Update lotto by ID
      description: >
        Update an existing plot information including dimensions, location
        coordinates, 

        sensor configurations, status, and other attributes.


        **Access Control:**

        - **Strictly reserved for Comune users only**


        Solo il Comune può modificare la configurazione dei lotti.
      tags:
        - Lotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the lotto to update
          example: 507f1f77bcf86cd799439011
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Lotto"
            example:
              numero: A1
              superficie: 55
              orto: 507f1f77bcf86cd799439011
              coordinate:
                lat: 46.4983
                lng: 11.3548
              sensori:
                - tipo: umidita
                  id: SENS001
                - tipo: temperatura
                  id: SENS002
                - tipo: ph
                  id: SENS003
              stato: occupato
      responses:
        "200":
          description: Lotto updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Lotto"
        "400":
          description: Invalid input data - Missing required fields or invalid format
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
                  errors:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune users can update lotti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: Lotto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Lotto not found
        "500":
          description: Internal server error while updating lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error updating lotto
                  error:
                    type: object
    delete:
      summary: Delete lotto by ID
      description: >
        Delete a plot by its unique identifier. This operation permanently
        removes the lotto 

        from the system.


        **Access Control:**

        - **Strictly reserved for Comune users only**


        **Business Rule:** RF17.3 - Il Comune può rimuovere lotti


        **Warning:** This operation may affect related entities (assignments,
        sensor data, etc.). 

        Ensure the lotto is not currently assigned before deletion.
      tags:
        - Lotti
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the lotto to delete
          example: 507f1f77bcf86cd799439011
      responses:
        "200":
          description: Lotto deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Lotto deleted successfully
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        "403":
          description: Forbidden - Only Comune users can delete lotti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        "404":
          description: Lotto not found with the specified ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Lotto not found
        "500":
          description: Internal server error while deleting lotto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error deleting lotto
                  error:
                    type: object
  /api/v1/meteo:
    get:
      summary: Get list of meteorological observations
      description: Retrieve a list of all meteorological observations (meteo). Returns
        an array of meteo objects with details including geographic coordinates,
        timestamp, and reading data.
      tags:
        - Meteo
      responses:
        "200":
          description: Successfully retrieved list of meteo observations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Meteo"
        "500":
          description: Error retrieving meteo observations
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving meteo observations
                  error:
                    type: object
  /api/v1/meteo/{id}:
    get:
      summary: Get meteorological observation by ID
      description: Retrieve a single meteorological observation by its unique identifier
      tags:
        - Meteo
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the meteo observation
      responses:
        "200":
          description: Successfully retrieved meteo observation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Meteo"
        "404":
          description: Meteo observation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Meteo observation not found
        "500":
          description: Error retrieving meteo observation
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving meteo observation
                  error:
                    type: object
  /api/v1/orti:
    get:
      summary: Get list of green gardens
      description: Retrieve a list of all green gardens (orti). Returns an array of
        orto objects with their details.
      tags:
        - Orti
      responses:
        "200":
          description: Successfully retrieved list of orti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Orto"
        "500":
          description: Error retrieving orti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving ortos
                  error:
                    type: object
    post:
      summary: Create a new orto
      description: Create a new green garden with the provided information. Only
        accessible by municipality users.
      security:
        - bearerAuth: []
      tags:
        - Orti
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Orto"
      responses:
        "201":
          description: Orto created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Orto"
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only municipality users can create orti
        "500":
          description: Error creating orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error creating orto
                  error:
                    type: object
  /api/v1/orti/search:
    get:
      summary: Search green gardens with filters
      description: Search for orti based on geographic location, plot size, and sensor
        availability
      tags:
        - Orti
      parameters:
        - in: query
          name: longitude
          schema:
            type: number
            format: float
          description: Longitude for geographic search (requires latitude and radius)
          example: 11.3426
        - in: query
          name: latitude
          schema:
            type: number
            format: float
          description: Latitude for geographic search (requires longitude and radius)
          example: 44.4949
        - in: query
          name: radius
          schema:
            type: number
            format: float
          description: Search radius in meters from the given coordinates
          example: 5000
        - in: query
          name: minSize
          schema:
            type: number
            format: float
          description: Minimum plot size (dimensione) in square meters
          example: 50
        - in: query
          name: maxSize
          schema:
            type: number
            format: float
          description: Maximum plot size (dimensione) in square meters
          example: 200
        - in: query
          name: hasSensors
          schema:
            type: boolean
          description: Filter orti that have plots with sensors
          example: true
      responses:
        "200":
          description: Successfully retrieved filtered orti
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: Number of orti found
                  filters:
                    type: object
                    description: Applied filters
                    properties:
                      longitude:
                        type: number
                      latitude:
                        type: number
                      radius:
                        type: number
                      minSize:
                        type: number
                      maxSize:
                        type: number
                      hasSensors:
                        type: boolean
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                        nome:
                          type: string
                        indirizzo:
                          type: string
                        geometry:
                          type: object
                        lotti:
                          type: array
                        distance:
                          type: number
                          description: Distance in meters (only if geographic search is used)
                        lottiCount:
                          type: integer
                          description: Total number of plots
                        matchingLottiCount:
                          type: integer
                          description: Number of plots matching the filter criteria
        "400":
          description: Invalid parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid coordinates
        "500":
          description: Error searching orti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error searching ortos
                  error:
                    type: object
  /api/v1/orti/{id}:
    get:
      summary: Get orto by ID
      description: Retrieve a single green garden by its unique identifier
      tags:
        - Orti
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the orto
      responses:
        "200":
          description: Successfully retrieved orto
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Orto"
        "404":
          description: Orto not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Orto not found
        "500":
          description: Error retrieving orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving orto
                  error:
                    type: object
    put:
      summary: Update orto by ID
      description: Update an existing green garden with new information. Only
        accessible by municipality users.
      security:
        - bearerAuth: []
      tags:
        - Orti
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the orto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Orto"
      responses:
        "200":
          description: Orto updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Orto"
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only municipality users can update orti
        "404":
          description: Orto not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Orto not found
        "500":
          description: Error updating orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error updating orto
                  error:
                    type: object
    delete:
      summary: Delete orto by ID
      description: Delete a green garden by its unique identifier. Only accessible by
        municipality users.
      security:
        - bearerAuth: []
      tags:
        - Orti
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the orto
      responses:
        "200":
          description: Orto deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Orto deleted successfully
        "401":
          description: Unauthorized - No token provided
        "403":
          description: Forbidden - Only municipality users can delete orti
        "404":
          description: Orto not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Orto not found
        "500":
          description: Error deleting orto
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error deleting orto
                  error:
                    type: object
  /api/v1/sensor:
    get:
      summary: Get list of sensor readings
      description: Retrieve a list of all sensor readings. Returns an array of sensor
        objects with details including lotto reference, timestamp, and reading
        data.
      tags:
        - Sensor
      responses:
        "200":
          description: Successfully retrieved list of sensor readings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Sensor"
        "500":
          description: Error retrieving sensor readings
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving sensor readings
                  error:
                    type: object
  /api/v1/sensor/{id}:
    get:
      summary: Get sensor reading by ID
      description: Retrieve a single sensor reading by its unique identifier
      tags:
        - Sensor
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the sensor reading
      responses:
        "200":
          description: Successfully retrieved sensor reading
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Sensor"
        "404":
          description: Sensor reading not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Sensor reading not found
        "500":
          description: Error retrieving sensor reading
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving sensor reading
                  error:
                    type: object
  /api/v1/utenti:
    post:
      summary: Create a new user
      description: Register a new user in the system. Password is hashed before
        storage. No authentication required for this endpoint.
      tags:
        - Utenti
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - nome
                - cognome
                - codicefiscale
                - email
                - password
                - indirizzo
                - telefono
              properties:
                nome:
                  type: string
                  description: User's first name
                  example: Paolo
                cognome:
                  type: string
                  description: User's last name
                  example: Rossi
                codicefiscale:
                  type: string
                  description: Tax ID (validated for EU countries)
                  example: RSSMRA80A01H501U
                email:
                  type: string
                  format: email
                  description: User's email (must be unique)
                  example: paolo.rossi@rossi.it
                password:
                  type: string
                  description: User's password (will be hashed)
                  example: securePassword123
                indirizzo:
                  type: string
                  description: User's address
                  example: Via Roma 10, Trento
                telefono:
                  type: string
                  description: Mobile phone number (validated)
                  example: 393331234567
                tipo:
                  type: string
                  enum:
                    - citt
                    - asso
                    - comu
                  description: User type (citt=citizen, asso=association, comu=municipality)
                  default: citt
                  example: citt
                associazione:
                  type: string
                  description: Associazione ObjectId (required if tipo=asso)
                  example: 507f1f77bcf86cd799439014
                comune:
                  type: string
                  description: Comune ObjectId (required if tipo=comu)
                  example: 507f1f77bcf86cd799439015
                admin:
                  type: boolean
                  description: Admin flag (required if tipo != citt)
                  default: false
                  example: false
            examples:
              citizen:
                summary: Create a citizen user
                value:
                  nome: Paolo
                  cognome: Rossi
                  codicefiscale: RSSMRA80A01H501U
                  email: paolo.rossi@rossi.it
                  password: securePassword123
                  indirizzo: Via Roma 10, Trento
                  telefono: 393331234567
                  tipo: citt
              association:
                summary: Create an association user
                value:
                  nome: Mario
                  cognome: Verdi
                  codicefiscale: VRDMRA75B15H501T
                  email: mario.verdi@ortitrento.it
                  password: securePassword123
                  indirizzo: Via delle Associazioni 45, Trento
                  telefono: 393331234568
                  tipo: asso
                  associazione: 507f1f77bcf86cd799439014
                  admin: true
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Utente creato con successo
                  utente:
                    $ref: "#/components/schemas/Utente"
                  self:
                    type: string
                    description: Link to created user resource
                    example: /api/v1/utenti/693bfed09c0ff8cb58ab35fe
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore di validazione
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      - PLRS12345678lmnn non è un codice fiscale valido per
                        nessun paese dell'UE
        "409":
          description: User already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Utente già esistente con questa email
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Errore nella creazione dell'utente
                  error:
                    type: string
    get:
      summary: Get list of users
      description: Retrieve a list of all users (utenti). Returns an array of utente
        objects with their details including nome, cognome, email, tipo, and
        references to associazione or comune if applicable.
      tags:
        - Utenti
      responses:
        "200":
          description: Successfully retrieved list of utenti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Utente"
        "500":
          description: Error retrieving utenti
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving utenti
                  error:
                    type: object
  /api/v1/utenti/{id}:
    get:
      summary: Get utente by ID
      description: Retrieve a single user by its unique identifier
      tags:
        - Utenti
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the utente
      responses:
        "200":
          description: Successfully retrieved utente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Utente"
        "404":
          description: Utente not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Utente not found
        "500":
          description: Error retrieving utente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error retrieving utente
                  error:
                    type: object
